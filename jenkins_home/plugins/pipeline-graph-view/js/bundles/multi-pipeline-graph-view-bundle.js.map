{"version":3,"file":"multi-pipeline-graph-view-bundle.js","sources":["../../../frontend/multi-pipeline-graph-view/multi-pipeline-graph/main/SingleRun.tsx","../../../frontend/multi-pipeline-graph-view/multi-pipeline-graph/main/support/startPollingRunsStatus.ts","../../../frontend/multi-pipeline-graph-view/multi-pipeline-graph/main/MultiPipelineGraph.tsx","../../../frontend/multi-pipeline-graph-view/app.tsx","../../../frontend/multi-pipeline-graph-view/index.tsx"],"sourcesContent":["import \"./single-run.scss\";\n\nimport StatusIcon from \"../../../common/components/status-icon.tsx\";\nimport useRunPoller from \"../../../common/tree-api.ts\";\nimport { time, Total } from \"../../../common/utils/timings.tsx\";\nimport { PipelineGraph } from \"../../../pipeline-graph-view/pipeline-graph/main/PipelineGraph.tsx\";\nimport {\n  defaultLayout,\n  LayoutInfo,\n} from \"../../../pipeline-graph-view/pipeline-graph/main/PipelineGraphModel.tsx\";\nimport { RunInfo } from \"./MultiPipelineGraphModel.ts\";\n\nexport default function SingleRun({ run, currentJobPath }: SingleRunProps) {\n  const { run: runInfo } = useRunPoller({\n    currentRunPath: currentJobPath + run.id + \"/\",\n  });\n\n  const layout: LayoutInfo = {\n    ...defaultLayout,\n    nodeSpacingH: 45,\n  };\n\n  return (\n    <div className=\"pgv-single-run\">\n      <div>\n        <a href={currentJobPath + run.id} className=\"pgw-user-specified-text\">\n          <StatusIcon status={run.result} />\n          {run.displayName}\n          <span>\n            {time(run.timestamp)} - <Total ms={run.duration} />\n          </span>\n        </a>\n      </div>\n      <PipelineGraph stages={runInfo?.stages || []} layout={layout} collapsed />\n    </div>\n  );\n}\n\ninterface SingleRunProps {\n  run: RunInfo;\n  currentJobPath: string;\n}\n","import { RunInfo } from \"../MultiPipelineGraphModel.ts\";\n\n/**\n * Starts polling the server to retrieve pipeline status.\n * Will only stop once the run is finished.\n */\nexport default function startPollingRunsStatus(\n  pathPrefix: string,\n  onFetchSuccess: (data: Array<RunInfo>) => void,\n  onFetchError: (err: Error) => void,\n  interval = 10000,\n) {\n  const path = pathPrefix + \"multi-pipeline-graph/runs\";\n\n  async function fetchPipelineData() {\n    try {\n      const res = await fetch(path);\n      const result = await res.json();\n      onFetchSuccess(result.data);\n    } catch (err) {\n      // TODO: implement exponential backoff of the timeout interval\n      onFetchError(err);\n    } finally {\n      setTimeout(() => fetchPipelineData(), interval);\n    }\n  }\n  fetchPipelineData();\n}\n","import { useContext, useEffect, useState } from \"react\";\n\nimport {\n  I18NContext,\n  LocaleContext,\n  LocalizedMessageKey,\n} from \"../../../common/i18n/index.ts\";\nimport { RunInfo } from \"./MultiPipelineGraphModel.ts\";\nimport SingleRun from \"./SingleRun.tsx\";\nimport startPollingRunsStatus from \"./support/startPollingRunsStatus.ts\";\n\nexport const MultiPipelineGraph = () => {\n  const [runs, setRuns] = useState<Array<RunInfo>>([]);\n  const [poll, setPoll] = useState(false);\n\n  const rootElement = document.getElementById(\"multiple-pipeline-root\");\n  const currentJobPath = rootElement!.dataset.currentJobPath!;\n\n  useEffect(() => {\n    if (!poll) {\n      setPoll(true);\n      startPollingRunsStatus(currentJobPath, setRuns, (err) => {\n        console.log(err);\n      });\n    }\n  }, [runs, poll]);\n\n  const locale = useContext(LocaleContext);\n\n  const groupedRuns: Record<string, RunInfo[]> = runs.reduce(\n    (acc: Record<string, RunInfo[]>, run) => {\n      const date = new Date(run.timestamp).toLocaleDateString(locale, {\n        year: \"numeric\",\n        month: \"long\",\n        day: \"numeric\",\n      });\n\n      if (!acc[date]) {\n        acc[date] = [];\n      }\n      acc[date].push(run);\n\n      return acc;\n    },\n    {},\n  );\n\n  const messages = useContext(I18NContext);\n\n  return (\n    <>\n      {Object.keys(groupedRuns).length === 0 ? (\n        <div className=\"pgv-stages__group\">\n          <div className=\"pgv-stages__heading\">\n            {messages.format(LocalizedMessageKey.noBuilds)}\n          </div>\n        </div>\n      ) : (\n        Object.entries(groupedRuns).map(([date, runsOnDate]) => (\n          <div className={\"pgv-stages__group\"} key={date}>\n            <p className=\"pgv-stages__heading\">{date}</p>\n            {runsOnDate.map((run) => (\n              <SingleRun\n                key={run.id}\n                run={run}\n                currentJobPath={currentJobPath}\n              />\n            ))}\n          </div>\n        ))\n      )}\n    </>\n  );\n};\n","import \"./app.scss\";\nimport \"./multi-pipeline-graph/styles/main.scss\";\n\nimport { FunctionComponent } from \"react\";\n\nimport {\n  I18NProvider,\n  LocaleProvider,\n  ResourceBundleName,\n} from \"../common/i18n/index.ts\";\nimport { MultiPipelineGraph } from \"./multi-pipeline-graph/main/MultiPipelineGraph.tsx\";\n\nconst App: FunctionComponent = () => {\n  const locale = document.getElementById(\"multiple-pipeline-root\")!.dataset\n    .userLocale!;\n  return (\n    <div>\n      <LocaleProvider locale={locale}>\n        <I18NProvider bundles={[ResourceBundleName.messages]}>\n          <MultiPipelineGraph />\n        </I18NProvider>\n      </LocaleProvider>\n    </div>\n  );\n};\n\nexport default App;\n","import { createRoot } from \"react-dom/client\";\n\nimport App from \"./app.tsx\";\n\nconst rootElement = document.getElementById(\"multiple-pipeline-root\");\nif (!rootElement) {\n  throw new Error(\"Failed to find the 'multiple-pipeline-root' element\");\n}\nconst root = createRoot(rootElement);\n\n// Render App\nroot.render(<App />);\n"],"names":["SingleRun","run","currentJobPath","runInfo","useRunPoller","layout","defaultLayout","jsxs","jsx","StatusIcon","time","Total","PipelineGraph","startPollingRunsStatus","pathPrefix","onFetchSuccess","onFetchError","interval","path","fetchPipelineData","result","err","MultiPipelineGraph","runs","setRuns","useState","poll","setPoll","useEffect","locale","useContext","LocaleContext","groupedRuns","acc","date","messages","I18NContext","Fragment","LocalizedMessageKey","runsOnDate","App","LocaleProvider","I18NProvider","ResourceBundleName","rootElement","root","createRoot"],"mappings":"oMAYA,SAAwBA,EAAU,CAAE,IAAAC,EAAK,eAAAC,GAAkC,CACzE,KAAM,CAAE,IAAKC,CAAQ,EAAIC,EAAa,CACpC,eAAgBF,EAAiBD,EAAI,GAAK,GAAA,CAC3C,EAEKI,EAAqB,CACzB,GAAGC,EACH,aAAc,EAChB,EAGE,OAAAC,EAAA,KAAC,MAAI,CAAA,UAAU,iBACb,SAAA,CAACC,EAAAA,IAAA,MAAA,CACC,gBAAC,IAAE,CAAA,KAAMN,EAAiBD,EAAI,GAAI,UAAU,0BAC1C,SAAA,CAACO,EAAAA,IAAAC,EAAA,CAAW,OAAQR,EAAI,MAAQ,CAAA,EAC/BA,EAAI,mBACJ,OACE,CAAA,SAAA,CAAAS,EAAKT,EAAI,SAAS,EAAE,MAAIO,EAAAA,IAAAG,EAAA,CAAM,GAAIV,EAAI,QAAU,CAAA,CAAA,CACnD,CAAA,CAAA,CAAA,CACF,CACF,CAAA,EACAO,MAACI,GAAc,QAAQT,GAAA,YAAAA,EAAS,SAAU,GAAI,OAAAE,EAAgB,UAAS,EAAC,CAAA,CAAA,EAC1E,CAEJ,CC9BA,SAAwBQ,EACtBC,EACAC,EACAC,EACAC,EAAW,IACX,CACA,MAAMC,EAAOJ,EAAa,4BAE1B,eAAeK,GAAoB,CAC7B,GAAA,CAEI,MAAAC,EAAS,MADH,MAAM,MAAMF,CAAI,GACH,KAAK,EAC9BH,EAAeK,EAAO,IAAI,QACnBC,EAAK,CAEZL,EAAaK,CAAG,CAAA,QAChB,CACW,WAAA,IAAMF,EAAkB,EAAGF,CAAQ,CAAA,CAChD,CAEgBE,EAAA,CACpB,CChBO,MAAMG,EAAqB,IAAM,CACtC,KAAM,CAACC,EAAMC,CAAO,EAAIC,EAAAA,SAAyB,CAAA,CAAE,EAC7C,CAACC,EAAMC,CAAO,EAAIF,EAAAA,SAAS,EAAK,EAGhCvB,EADc,SAAS,eAAe,wBAAwB,EAChC,QAAQ,eAE5C0B,EAAAA,UAAU,IAAM,CACTF,IACHC,EAAQ,EAAI,EACWd,EAAAX,EAAgBsB,EAAUH,GAAQ,CACvD,QAAQ,IAAIA,CAAG,CAAA,CAChB,EACH,EACC,CAACE,EAAMG,CAAI,CAAC,EAET,MAAAG,EAASC,aAAWC,CAAa,EAEjCC,EAAyCT,EAAK,OAClD,CAACU,EAAgChC,IAAQ,CACvC,MAAMiC,EAAO,IAAI,KAAKjC,EAAI,SAAS,EAAE,mBAAmB4B,EAAQ,CAC9D,KAAM,UACN,MAAO,OACP,IAAK,SAAA,CACN,EAEG,OAACI,EAAIC,CAAI,IACPD,EAAAC,CAAI,EAAI,CAAC,GAEXD,EAAAC,CAAI,EAAE,KAAKjC,CAAG,EAEXgC,CACT,EACA,CAAA,CACF,EAEME,EAAWL,aAAWM,CAAW,EAEvC,OAEK5B,EAAA,IAAA6B,EAAA,SAAA,CAAA,SAAA,OAAO,KAAKL,CAAW,EAAE,SAAW,EAClCxB,EAAA,IAAA,MAAA,CAAI,UAAU,oBACb,SAAAA,EAAAA,IAAC,MAAI,CAAA,UAAU,sBACZ,SAAS2B,EAAA,OAAOG,EAAoB,QAAQ,EAC/C,CACF,CAAA,EAEA,OAAO,QAAQN,CAAW,EAAE,IAAI,CAAC,CAACE,EAAMK,CAAU,IAC/ChC,EAAAA,KAAA,MAAA,CAAI,UAAW,oBACd,SAAA,CAACC,EAAA,IAAA,IAAA,CAAE,UAAU,sBAAuB,SAAK0B,EAAA,EACxCK,EAAW,IAAKtC,GACfO,EAAA,IAACR,EAAA,CAEC,IAAAC,EACA,eAAAC,CAAA,EAFKD,EAAI,EAIZ,CAAA,CAAA,GARuCiC,CAS1C,CACD,EAEL,CAEJ,EC7DMM,EAAyB,IAAM,CACnC,MAAMX,EAAS,SAAS,eAAe,wBAAwB,EAAG,QAC/D,WACH,aACG,MACC,CAAA,SAAArB,EAAAA,IAACiC,EAAe,CAAA,OAAAZ,EACd,eAACa,EAAa,CAAA,QAAS,CAACC,EAAmB,QAAQ,EACjD,SAAAnC,EAAAA,IAACc,EAAmB,EAAA,CAAA,CACtB,CACF,CAAA,EACF,CAEJ,ECpBMsB,EAAc,SAAS,eAAe,wBAAwB,EACpE,GAAI,CAACA,EACG,MAAA,IAAI,MAAM,qDAAqD,EAEvE,MAAMC,EAAOC,aAAWF,CAAW,EAGnCC,EAAK,OAAQrC,EAAAA,IAAAgC,EAAA,CAAI,CAAA,CAAE"}